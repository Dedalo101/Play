<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Donkey Kong Game - AGG Homes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #8B4513 0%, #654321 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            color: white;
            overflow: hidden;
        }
        
        h1 {
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-size: 2.5rem;
        }
        
        .back-link {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: rgba(255,255,255,0.2);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-weight: bold;
            z-index: 10;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        
        .back-link:hover {
            background-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .game-info {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .info-item {
            background-color: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            font-weight: bold;
            min-width: 100px;
            text-align: center;
        }
        
        #game-container {
            background-color: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            border: 2px solid rgba(255,255,255,0.3);
            position: relative;
        }
        
        #game-canvas {
            display: block;
            background-color: #000080;
            border: 3px solid white;
            border-radius: 10px;
            max-width: 100%;
            max-height: 70vh;
        }
        
        #controls {
            text-align: center;
            margin: 20px 0;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 24px;
            font-size: 16px;
            cursor: pointer;
            background-color: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid white;
            border-radius: 25px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-weight: bold;
            min-width: 100px;
        }
        
        button:hover:not(:disabled) {
            background-color: rgba(255,255,255,0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        button:disabled {
            background-color: rgba(255,255,255,0.1);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .mobile-controls {
            display: none;
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            gap: 15px;
            z-index: 100;
        }

        .mobile-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            border: 2px solid white;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
            backdrop-filter: blur(10px);
        }

        .mobile-btn:active {
            background: rgba(255,255,255,0.5);
            transform: scale(0.95);
        }

        .jump-btn {
            width: 80px;
            height: 80px;
            font-size: 24px;
        }

        #instructions {
            text-align: center;
            margin-top: 20px;
            color: rgba(255,255,255,0.9);
            max-width: 500px;
            background-color: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .mobile-controls {
                display: flex;
            }
            
            #instructions {
                margin-bottom: 120px;
            }
            
            .back-link {
                top: 10px;
                left: 10px;
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            h1 {
                font-size: 1.8rem;
            }
            
            .mobile-btn {
                width: 50px;
                height: 50px;
                font-size: 16px;
            }
            
            .jump-btn {
                width: 70px;
                height: 70px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">‚Üê Menu</a>
    
    <h1>ü¶ç Donkey Kong</h1>
    
    <div class="game-info">
        <div class="info-item">
            Score: <span id="score">0</span>
        </div>
        <div class="info-item">
            Level: <span id="level">1</span>
        </div>
        <div class="info-item">
            Lives: <span id="lives">3</span>
        </div>
    </div>
    
    <div id="game-container">
        <canvas id="game-canvas" width="800" height="600"></canvas>
    </div>
    
    <div id="controls">
        <button id="start-btn">Start Game</button>
        <button id="pause-btn" disabled>Pause</button>
        <button id="reset-btn">Reset</button>
    </div>

    <!-- Mobile controls -->
    <div class="mobile-controls">
        <div class="mobile-btn" id="left-btn">‚Üê</div>
        <div class="mobile-btn" id="right-btn">‚Üí</div>
        <div class="mobile-btn" id="up-btn">‚Üë</div>
        <div class="mobile-btn" id="down-btn">‚Üì</div>
        <div class="mobile-btn jump-btn" id="jump-btn">JUMP</div>
    </div>
    
    <div id="instructions">
        <p><strong>Desktop:</strong> Arrow keys to move, SPACE to jump</p>
        <p><strong>Mobile:</strong> Use the control buttons below</p>
        <p>Climb ladders, avoid barrels, and reach the top to save the princess!</p>
    </div>

    <script>
        console.log('Donkey Kong game script starting...');
        
        // Wait for DOM to load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, initializing game...');
            initGame();
        });
        
        function initGame() {
            const canvas = document.getElementById('game-canvas');
            if (!canvas) {
                console.error('Canvas element not found!');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.error('Canvas context not available!');
                return;
            }
            
            const scoreElement = document.getElementById('score');
            const levelElement = document.getElementById('level');
            const livesElement = document.getElementById('lives');
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const resetBtn = document.getElementById('reset-btn');

            console.log('All elements found, setting up game...');

            // Game state
            let gameState = {
                running: false,
                paused: false,
                score: 0,
                level: 1,
                lives: 3,
                gameLoop: null
            };

            // Audio context for sounds
            let audioContext;
            function initAudio() {
                try {
                    if (!audioContext) {
                        audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    }
                } catch (e) {
                    console.log('Audio not supported');
                }
            }

            function playJumpSound() {
                if (!audioContext) return;
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(400, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(200, audioContext.currentTime + 0.2);
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                } catch (e) {
                    console.log('Sound play failed');
                }
            }

            function playCollectSound() {
                if (!audioContext) return;
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(1200, audioContext.currentTime + 0.1);
                    
                    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                } catch (e) {
                    console.log('Sound play failed');
                }
            }

            function playHitSound() {
                if (!audioContext) return;
                try {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.setValueAtTime(150, audioContext.currentTime);
                    oscillator.frequency.exponentialRampToValueAtTime(50, audioContext.currentTime + 0.3);
                    
                    gainNode.gain.setValueAtTime(0.4, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                } catch (e) {
                    console.log('Sound play failed');
                }
            }

            // Game objects
            const mario = {
                x: 50,
                y: 500,
                width: 20,
                height: 30,
                vx: 0,
                vy: 0,
                speed: 3,
                jumpPower: -12,
                onGround: false,
                onLadder: false,
                direction: 1, // 1 = right, -1 = left
                color: '#FF0000'
            };

            const donkeyKong = {
                x: 100,
                y: 80,
                width: 60,
                height: 50,
                color: '#8B4513',
                barrelTimer: 0,
                barrelDelay: 2000 // milliseconds
            };

            const princess = {
                x: 150,
                y: 50,
                width: 20,
                height: 30,
                color: '#FFB6C1'
            };

            // Game elements
            let platforms = [];
            let ladders = [];
            let barrels = [];
            let hammers = [];
            let powerUps = [];

            // Input handling
            const keys = {};
            
            function handleKeyDown(e) {
                keys[e.code] = true;
                e.preventDefault();
            }
            
            function handleKeyUp(e) {
                keys[e.code] = false;
                e.preventDefault();
            }

            // Mobile controls
            function setupMobileControls() {
                const leftBtn = document.getElementById('left-btn');
                const rightBtn = document.getElementById('right-btn');
                const upBtn = document.getElementById('up-btn');
                const downBtn = document.getElementById('down-btn');
                const jumpBtn = document.getElementById('jump-btn');

                // Touch events for mobile buttons
                leftBtn.addEventListener('touchstart', () => keys['ArrowLeft'] = true);
                leftBtn.addEventListener('touchend', () => keys['ArrowLeft'] = false);
                
                rightBtn.addEventListener('touchstart', () => keys['ArrowRight'] = true);
                rightBtn.addEventListener('touchend', () => keys['ArrowRight'] = false);
                
                upBtn.addEventListener('touchstart', () => keys['ArrowUp'] = true);
                upBtn.addEventListener('touchend', () => keys['ArrowUp'] = false);
                
                downBtn.addEventListener('touchstart', () => keys['ArrowDown'] = true);
                downBtn.addEventListener('touchend', () => keys['ArrowDown'] = false);
                
                jumpBtn.addEventListener('touchstart', () => keys['Space'] = true);
                jumpBtn.addEventListener('touchend', () => keys['Space'] = false);

                // Prevent default touch behavior
                [leftBtn, rightBtn, upBtn, downBtn, jumpBtn].forEach(btn => {
                    btn.addEventListener('touchstart', e => e.preventDefault());
                    btn.addEventListener('touchend', e => e.preventDefault());
                });
            }

            // Initialize level structure
            function initLevel() {
                platforms = [
                    // Bottom platform
                    { x: 0, y: 550, width: 800, height: 20, color: '#8B4513' },
                    // Level 1 platforms
                    { x: 0, y: 450, width: 200, height: 20, color: '#8B4513' },
                    { x: 300, y: 450, width: 500, height: 20, color: '#8B4513' },
                    // Level 2 platforms
                    { x: 0, y: 350, width: 500, height: 20, color: '#8B4513' },
                    { x: 600, y: 350, width: 200, height: 20, color: '#8B4513' },
                    // Level 3 platforms
                    { x: 200, y: 250, width: 400, height: 20, color: '#8B4513' },
                    // Level 4 platforms
                    { x: 0, y: 150, width: 300, height: 20, color: '#8B4513' },
                    { x: 500, y: 150, width: 300, height: 20, color: '#8B4513' },
                    // Top platform
                    { x: 100, y: 50, width: 200, height: 20, color: '#8B4513' }
                ];

                ladders = [
                    // Connecting ladders between platforms
                    { x: 180, y: 450, width: 20, height: 100, color: '#DAA520' },
                    { x: 750, y: 350, width: 20, height: 100, color: '#DAA520' },
                    { x: 150, y: 250, width: 20, height: 100, color: '#DAA520' },
                    { x: 650, y: 150, width: 20, height: 100, color: '#DAA520' },
                    { x: 280, y: 50, width: 20, height: 100, color: '#DAA520' }
                ];

                barrels = [];
                hammers = [
                    { x: 400, y: 420, width: 30, height: 20, active: true, color: '#FFD700' }
                ];
                powerUps = [];

                // Reset positions
                mario.x = 50;
                mario.y = 500;
                mario.vx = 0;
                mario.vy = 0;
                mario.onGround = false;
                mario.onLadder = false;
            }

            // Physics and collision detection
            function checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }

            function updateMario() {
                // Handle input
                mario.vx = 0;
                
                if (keys['ArrowLeft']) {
                    mario.vx = -mario.speed;
                    mario.direction = -1;
                }
                if (keys['ArrowRight']) {
                    mario.vx = mario.speed;
                    mario.direction = 1;
                }

                // Ladder climbing
                mario.onLadder = false;
                for (let ladder of ladders) {
                    if (checkCollision(mario, ladder)) {
                        mario.onLadder = true;
                        if (keys['ArrowUp']) {
                            mario.vy = -mario.speed;
                            mario.onGround = false;
                        }
                        if (keys['ArrowDown']) {
                            mario.vy = mario.speed;
                        }
                        break;
                    }
                }

                // Jumping
                if (keys['Space'] && mario.onGround && !mario.onLadder) {
                    mario.vy = mario.jumpPower;
                    mario.onGround = false;
                    playJumpSound();
                }

                // Apply gravity
                if (!mario.onLadder) {
                    mario.vy += 0.8; // gravity
                }

                // Update position
                mario.x += mario.vx;
                mario.y += mario.vy;

                // Platform collision
                mario.onGround = false;
                for (let platform of platforms) {
                    if (mario.x < platform.x + platform.width &&
                        mario.x + mario.width > platform.x &&
                        mario.y + mario.height > platform.y &&
                        mario.y + mario.height < platform.y + platform.height + 10 &&
                        mario.vy >= 0) {
                        mario.y = platform.y - mario.height;
                        mario.vy = 0;
                        mario.onGround = true;
                    }
                }

                // Screen boundaries
                if (mario.x < 0) mario.x = 0;
                if (mario.x + mario.width > canvas.width) mario.x = canvas.width - mario.width;
                
                // Fall off screen
                if (mario.y > canvas.height) {
                    loseLife();
                }
            }

            function updateBarrels() {
                // Spawn barrels from Donkey Kong
                donkeyKong.barrelTimer += 16; // assuming 60fps
                if (donkeyKong.barrelTimer >= donkeyKong.barrelDelay) {
                    barrels.push({
                        x: donkeyKong.x + 30,
                        y: donkeyKong.y + 50,
                        width: 15,
                        height: 15,
                        vx: 2,
                        vy: 0,
                        color: '#8B4513'
                    });
                    donkeyKong.barrelTimer = 0;
                }

                // Update barrel physics
                for (let i = barrels.length - 1; i >= 0; i--) {
                    const barrel = barrels[i];
                    
                    // Apply gravity
                    barrel.vy += 0.5;
                    
                    // Update position
                    barrel.x += barrel.vx;
                    barrel.y += barrel.vy;

                    // Platform collision
                    for (let platform of platforms) {
                        if (barrel.x < platform.x + platform.width &&
                            barrel.x + barrel.width > platform.x &&
                            barrel.y + barrel.height > platform.y &&
                            barrel.y + barrel.height < platform.y + platform.height + 10 &&
                            barrel.vy >= 0) {
                            barrel.y = platform.y - barrel.height;
                            barrel.vy = 0;
                            
                            // Bounce off edges
                            if (barrel.x <= platform.x || barrel.x + barrel.width >= platform.x + platform.width) {
                                barrel.vx *= -1;
                            }
                        }
                    }

                    // Remove barrels that fall off screen
                    if (barrel.y > canvas.height || barrel.x < -50 || barrel.x > canvas.width + 50) {
                        barrels.splice(i, 1);
                        continue;
                    }

                    // Check collision with Mario
                    if (checkCollision(mario, barrel)) {
                        loseLife();
                        barrels.splice(i, 1);
                    }
                }
            }

            function checkWinCondition() {
                // Check if Mario reached the princess
                if (checkCollision(mario, princess)) {
                    nextLevel();
                }
            }

            function loseLife() {
                playHitSound();
                gameState.lives--;
                livesElement.textContent = gameState.lives;
                
                if (gameState.lives <= 0) {
                    gameOver();
                } else {
                    // Reset Mario position
                    mario.x = 50;
                    mario.y = 500;
                    mario.vx = 0;
                    mario.vy = 0;
                    
                    // Vibrate on mobile
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200]);
                    }
                }
            }

            function nextLevel() {
                playCollectSound();
                gameState.level++;
                gameState.score += 1000;
                levelElement.textContent = gameState.level;
                scoreElement.textContent = gameState.score;
                
                // Increase difficulty
                donkeyKong.barrelDelay = Math.max(1000, donkeyKong.barrelDelay - 200);
                
                initLevel();
            }

            function gameOver() {
                gameState.running = false;
                clearInterval(gameState.gameLoop);
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                
                setTimeout(() => {
                    alert(`ü¶ç Game Over! ü¶ç\nFinal Score: ${gameState.score}\nLevel Reached: ${gameState.level}`);
                }, 100);
            }

            // Drawing functions
            function draw() {
                // Clear canvas
                ctx.fillStyle = '#000080';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Draw platforms
                platforms.forEach(platform => {
                    ctx.fillStyle = platform.color;
                    ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                });

                // Draw ladders
                ladders.forEach(ladder => {
                    ctx.fillStyle = ladder.color;
                    ctx.fillRect(ladder.x, ladder.y, ladder.width, ladder.height);
                    
                    // Draw ladder rungs
                    ctx.fillStyle = '#8B4513';
                    for (let y = ladder.y; y < ladder.y + ladder.height; y += 15) {
                        ctx.fillRect(ladder.x, y, ladder.width, 3);
                    }
                });

                // Draw Donkey Kong
                ctx.fillStyle = donkeyKong.color;
                ctx.fillRect(donkeyKong.x, donkeyKong.y, donkeyKong.width, donkeyKong.height);
                
                // Draw DK face
                ctx.fillStyle = '#000000';
                ctx.fillRect(donkeyKong.x + 15, donkeyKong.y + 10, 5, 5); // eye
                ctx.fillRect(donkeyKong.x + 40, donkeyKong.y + 10, 5, 5); // eye
                ctx.fillRect(donkeyKong.x + 25, donkeyKong.y + 20, 10, 5); // mouth

                // Draw Princess
                ctx.fillStyle = princess.color;
                ctx.fillRect(princess.x, princess.y, princess.width, princess.height);

                // Draw Mario
                ctx.fillStyle = mario.color;
                ctx.fillRect(mario.x, mario.y, mario.width, mario.height);
                
                // Draw Mario hat
                ctx.fillStyle = '#FF0000';
                ctx.fillRect(mario.x, mario.y, mario.width, 8);

                // Draw barrels
                barrels.forEach(barrel => {
                    ctx.fillStyle = barrel.color;
                    ctx.fillRect(barrel.x, barrel.y, barrel.width, barrel.height);
                });

                // Draw hammers
                hammers.forEach(hammer => {
                    if (hammer.active) {
                        ctx.fillStyle = hammer.color;
                        ctx.fillRect(hammer.x, hammer.y, hammer.width, hammer.height);
                    }
                });
            }

            // Game loop
            function gameLoop() {
                if (!gameState.running || gameState.paused) return;

                updateMario();
                updateBarrels();
                checkWinCondition();
                draw();
            }

            // Game controls
            function startGame() {
                if (gameState.running) return;
                
                initAudio();
                gameState.running = true;
                gameState.paused = false;
                gameState.score = 0;
                gameState.level = 1;
                gameState.lives = 3;
                
                scoreElement.textContent = gameState.score;
                levelElement.textContent = gameState.level;
                livesElement.textContent = gameState.lives;
                
                initLevel();
                
                startBtn.disabled = true;
                pauseBtn.disabled = false;
                
                gameState.gameLoop = setInterval(gameLoop, 16); // ~60fps
                console.log('Donkey Kong game started');
            }

            function pauseGame() {
                if (!gameState.running) return;
                
                gameState.paused = !gameState.paused;
                pauseBtn.textContent = gameState.paused ? 'Resume' : 'Pause';
            }

            function resetGame() {
                gameState.running = false;
                gameState.paused = false;
                clearInterval(gameState.gameLoop);
                
                gameState.score = 0;
                gameState.level = 1;
                gameState.lives = 3;
                
                scoreElement.textContent = gameState.score;
                levelElement.textContent = gameState.level;
                livesElement.textContent = gameState.lives;
                
                initLevel();
                draw();
                
                startBtn.disabled = false;
                pauseBtn.disabled = true;
                pauseBtn.textContent = 'Pause';
            }

            // Event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            
            startBtn.addEventListener('click', startGame);
            pauseBtn.addEventListener('click', pauseGame);
            resetBtn.addEventListener('click', resetGame);

            // Setup mobile controls
            setupMobileControls();

            // Initial draw
            initLevel();
            draw();
            
            console.log('Donkey Kong game initialized successfully');
        }
    </script>
</body>
</html>